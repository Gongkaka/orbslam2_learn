# ORB-SLAM2运动估计——Design by 叶培楚（小C）

## 依赖项
1. **OpenCV 3**
    主要用于图像读取,特征匹配,运动估计和显示等;
2. **g2o**
    主要用于优化相机姿态;
3. **Eigen**
    一些数值结构;
4. **Sophus**
    g2o相关联的边和节点中需要;

## 编译
1. 要求至少系统中包含OpenCV3, Eigen3, Sophus;
2. 先编译g2o:
    cd $path/thirdparty/g2o/  
    mkdir build  
    cd build  
    cmake ..  
    make -j8  
    非常常规的编译!
3. 编译源代码  
    cd $path/source_code (源代码所在根目录)  
    mkdir build  
    cd build  
    cmake ..  
    make -j8 

## 思路
在ORB-SLAM2中的运动估计主要是基于pnp来做运动估计的.其中分为两个部分:   

一. **基于参考帧的运动估计**
    
假设有参考帧Ir和当前帧Ic:   
1. 对两帧图像进行图像特征匹配;    
2. 将参考帧中匹配点对应的三维坐标提取出来;     
3. 利用OpenCV提供的pnp函数计算初值相对姿态;     
4. 利用非线性优化方法优化姿态,完成运动估计.     

二. **基于运动模型的运动估计**

假设有参考帧Ir和当前帧Ic:   
1. 对两帧图像进行图像特征匹配   
2. 提取参考帧中的三维特征点;     
3. 基于运动模型,将参考帧中的三维点投影到当前帧中;     
4. 与步骤1中在当前帧Ic中的匹配点构成重投影误差;      
5. 基于非线性优化方法优化初始运动模型,完成运动估计.    


## 代码思路
同样,为了保持当前模块的代码与其他模块解耦,本模块还是设计为可以独立运行的版本.实现思路:  

1. 读取图像I1, I2, I3, 同时读取对应的深度图像D1, D2, D3;
2. 对图像I1, I2, I3提取特征点;
3. 从深度图像D1, D2, D3中保存对应特征点的深度值;

一. **基于参考帧的运动估计**    

4. 对图像I1和图像I2进行特征点匹配;  
5. 以图像1为参考帧,图像I2为当前帧,取出参考帧中的特征点三维值;   
6. 利用OpenCV提供的pnp函数计算初始运动估计;  
7. 利用g2o优化做非线性优化来优化初始值;  
8. 并用重投影误差来评估估计结果;    

二. **基于运动模型的运动估计**

9. 以*基于参考帧的运动估计*得到的运动估计结果作为运动模型;     
10. 对图像I2和图像I3进行特征匹配;    
11. 取图像I2中的特征点三维值;    
12. 利用运动模型,将图像I2中的三维值投影到图像I3中;  
13. 图像I2的投影点与图像I3中的特征匹配点构成重投影误差;   
14. 利用g2o优化库做非线性优化,估计最优的相对姿态;   
15. 同样也是以重投影误差来评估优化结果.   

## 参考资料
本模块是C哥为了完善博客而写的,所以本模块对应的博客为[ORBSLAM运动估计](https://www.cnblogs.com/yepeichu/p/10746952.html).欢迎大家批评指正!       
C哥邮箱为:peichu.ye@mail2.gdut.edu.cn,欢迎交流!  